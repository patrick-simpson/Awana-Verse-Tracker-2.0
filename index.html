
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awana Africa Tracker | Broadcast Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Poppins:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Nunito', sans-serif; background-color: #1a1a1a; cursor: crosshair; }
        .text-outline { -webkit-text-stroke: 4px rgba(0,0,0,0.25); }
        .glass-panel { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border: 2px solid rgba(255, 255, 255, 0.2); }
        
        @keyframes drift {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(20px, -30px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .drifter { animation: drift 8s ease-in-out infinite; }
        
        #root:empty::after {
            content: 'PREPARING BROADCAST ENGINE...';
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #FBBF24; font-weight: 900; letter-spacing: 0.5em; font-size: 0.7rem; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        .ripple {
            position: absolute; border-radius: 50%; background: white;
            transform: scale(0); opacity: 0.5; pointer-events: none; z-index: 5;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
    "firebase/database": "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "firebase/": "https://esm.sh/firebase@^12.9.0/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp, getApps, getApp } from 'firebase/app';
        import { getDatabase, ref, onValue, set } from 'firebase/database';

        const firebaseConfig = {
            apiKey: "AIzaSyCk0TR4SUFUvsdpIDGmH-0CzbZQQcZBL30",
            authDomain: "awana-africa-tracker.firebaseapp.com",
            databaseURL: "https://awana-africa-tracker-default-rtdb.firebaseio.com",
            projectId: "awana-africa-tracker",
            storageBucket: "awana-africa-tracker.firebasestorage.app",
            messagingSenderId: "825987576771",
            appId: "1:825987576771:web:f293d618dad3ded2c70376"
        };

        const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();
        const db = getDatabase(app);

        const THEMES = {
            0: { name: "Savanna Sunrise", gradient: "from-orange-500 via-amber-400 to-yellow-300", text: "text-white", sec: "text-orange-950", anim: 'fall', elements: ["ü¶í", "üêò", "‚òÄÔ∏è", "üå≥"] },
            100: { name: "Village Map", gradient: "from-amber-800 via-stone-700 to-stone-900", text: "text-stone-100", sec: "text-amber-400", anim: 'slide', elements: ["üó∫Ô∏è", "ü•Å", "üõñ", "üìç"] },
            200: { name: "School Build", gradient: "from-teal-500 via-emerald-600 to-emerald-900", text: "text-white", sec: "text-teal-200", anim: 'pop', elements: ["üß±", "üè´", "üî®", "üèóÔ∏è"] },
            300: { name: "Jungle Vine", gradient: "from-green-600 via-green-800 to-black", text: "text-lime-200", sec: "text-green-400", anim: 'spiral', elements: ["üçÉ", "üêí", "ü¶ú", "üåø"] },
            400: { name: "Great River", gradient: "from-blue-500 via-blue-700 to-indigo-950", text: "text-white", sec: "text-blue-300", anim: 'wave', elements: ["üõ∂", "üåä", "üêü", "üíß"] },
            500: { name: "Starry Night", gradient: "from-indigo-950 via-purple-900 to-black", text: "text-yellow-100", sec: "text-indigo-400", anim: 'zoom', elements: ["‚ú®", "üåô", "ü¶â", "‚≠ê"] },
            600: { name: "Market Joy", gradient: "from-rose-500 via-red-600 to-orange-700", text: "text-white", sec: "text-rose-200", anim: 'bounce', elements: ["üçé", "üëó", "üß∫", "üçç"] },
            800: { name: "Victory Lap", gradient: "from-yellow-400 via-amber-500 to-red-600", text: "text-red-950", sec: "text-amber-900", anim: 'celebrate', elements: ["ü¶Å", "üèÜ", "üéñÔ∏è", "üî•"] }
        };

        const getTheme = (count) => {
            const keys = Object.keys(THEMES).map(Number).sort((a,b) => b-a);
            return THEMES[keys.find(k => count >= k)] || THEMES[0];
        };

        let audioCtx = null;
        const playPop = (freq = 440) => {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(freq/4, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        };

        const App = () => {
            const [count, setCount] = useState(0);
            const [isStarted, setIsStarted] = useState(false);
            const [isAdmin, setIsAdmin] = useState(false);
            const [syncing, setSyncing] = useState(true);
            const prevCount = useRef(0);
            const numberRef = useRef(null);
            const containerRef = useRef(null);
            const theme = useMemo(() => getTheme(count), [count]);

            useEffect(() => {
                const countRef = ref(db, 'verseCount/current');
                const unsub = onValue(countRef, (snap) => {
                    const val = snap.val();
                    if (val !== null) setCount(Number(val));
                    setSyncing(false);
                });
                return () => unsub();
            }, []);

            useEffect(() => {
                if (count !== prevCount.current && isStarted) {
                    triggerAnimations();
                    prevCount.current = count;
                }
            }, [count, isStarted]);

            const triggerAnimations = () => {
                const isMilestone = count > 0 && count % 50 === 0;
                playPop(isMilestone ? 880 : 440);

                if (!window.gsap) return;

                // 1. Shockwave Ripple
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                const size = Math.max(window.innerWidth, window.innerHeight) * 1.5;
                ripple.style.width = ripple.style.height = `${size}px`;
                ripple.style.left = `calc(50% - ${size/2}px)`;
                ripple.style.top = `calc(50% - ${size/2}px)`;
                containerRef.current.appendChild(ripple);

                window.gsap.to(ripple, {
                    scale: 1, opacity: 0, duration: 1, ease: "power2.out",
                    onComplete: () => ripple.remove()
                });

                // 2. Number Feedback
                const tl = window.gsap.timeline();
                
                // Theme-Specific Entry Logic
                switch(theme.anim) {
                    case 'spiral':
                        tl.fromTo(numberRef.current, { rotation: -180, scale: 0, opacity: 0 }, { rotation: 0, scale: 1, opacity: 1, duration: 0.8, ease: "back.out(1.7)" });
                        break;
                    case 'bounce':
                        tl.fromTo(numberRef.current, { y: -400, scale: 1.5 }, { y: 0, scale: 1, duration: 1, ease: "bounce.out" });
                        break;
                    case 'wave':
                        tl.fromTo(numberRef.current, { x: -200, opacity: 0 }, { x: 0, opacity: 1, duration: 0.6, ease: "sine.inOut" });
                        break;
                    case 'celebrate':
                        tl.fromTo(numberRef.current, { scale: 2, filter: 'brightness(5)' }, { scale: 1, filter: 'brightness(1)', duration: 0.5, ease: "elastic.out(1, 0.3)" });
                        break;
                    case 'fall':
                        tl.fromTo(numberRef.current, { y: -200, opacity: 0 }, { y: 0, opacity: 1, duration: 0.7, ease: "power4.out" });
                        break;
                    default:
                        tl.fromTo(numberRef.current, { scale: 0.5, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.4, ease: "back.out" });
                }

                // Flash the screen briefly on milestone
                if (isMilestone) {
                    window.gsap.to(containerRef.current, { filter: 'brightness(1.5)', duration: 0.1, yoyo: true, repeat: 1 });
                }
            };

            const updateCount = (newVal) => set(ref(db, 'verseCount/current'), Math.max(0, newVal));

            return (
                <div ref={containerRef} className={`w-full h-screen bg-gradient-to-br ${theme.gradient} flex items-center justify-center transition-all duration-1000 overflow-hidden`}>
                    
                    {/* Layered Whimsy Parallax */}
                    <div className="absolute inset-0 pointer-events-none opacity-20">
                        {theme.elements.map((el, i) => (
                            <div key={i} className="absolute drifter select-none" 
                                style={{ 
                                    left: `${10+i*25}%`, top: `${15+i*20}%`, 
                                    fontSize: `${5 + (i%3)*5}rem`,
                                    animationDelay: `${i*1.5}s`,
                                    zIndex: 1
                                }}>
                                {el}
                            </div>
                        ))}
                    </div>

                    <div className="z-10 text-center relative">
                        <div className="mb-6">
                            <span className={`inline-block px-8 py-2 rounded-full border-2 border-current font-black tracking-[0.3em] uppercase text-xs md:text-sm ${theme.sec} glass-panel bg-white/5`}>
                                {theme.name}
                            </span>
                        </div>
                        
                        <div className="relative group">
                            <div className="absolute -inset-8 bg-white/10 blur-3xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div className="glass-panel px-12 md:px-24 py-12 md:py-16 rounded-[4rem] shadow-[0_35px_60px_-15px_rgba(0,0,0,0.3)] border-4 border-white/20">
                                <div ref={numberRef} className={`text-[32vw] md:text-[22vw] font-[900] text-outline leading-none select-none drop-shadow-[0_10px_10px_rgba(0,0,0,0.5)] ${theme.text}`} style={{ fontFamily: 'Poppins, sans-serif' }}>
                                    {count}
                                </div>
                            </div>
                        </div>

                        <div className="mt-12 flex flex-col items-center gap-2">
                            <div className="text-white/30 font-mono text-[10px] tracking-[0.6em] uppercase">
                                Broadcast Active // {syncing ? 'Connecting...' : 'Synchronized'}
                            </div>
                            <div className="h-1 w-32 bg-white/10 rounded-full overflow-hidden">
                                <div className="h-full bg-yellow-400 transition-all duration-500" style={{ width: `${(count % 100)}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* Branding Overlay */}
                    <div className="fixed top-8 left-8 flex items-center gap-4 opacity-40">
                        <div className="w-10 h-10 bg-yellow-400 rounded-lg flex items-center justify-center font-black text-stone-900 text-xl">A</div>
                        <div className="text-white font-black leading-none tracking-tighter">
                            AWANA<br/><span className="text-yellow-400">AFRICA</span>
                        </div>
                    </div>

                    {/* Admin Dashboard */}
                    <div className="fixed bottom-8 right-8 z-[100]">
                        <button onClick={() => setIsAdmin(!isAdmin)} className="p-4 text-white opacity-10 hover:opacity-100 transition-all hover:rotate-90 bg-black/20 rounded-full backdrop-blur-md border border-white/10">‚öôÔ∏è</button>
                        {isAdmin && (
                            <div className="absolute bottom-20 right-0 w-72 glass-panel p-8 rounded-[2.5rem] text-white shadow-2xl animate-in slide-in-from-bottom-5">
                                <h3 className="font-black mb-6 text-yellow-400 tracking-widest text-sm uppercase">Broadcast Desk</h3>
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    <button onClick={() => updateCount(count + 1)} className="bg-white/10 hover:bg-yellow-400 hover:text-stone-900 p-4 rounded-2xl font-black text-xl transition-all active:scale-90">+1</button>
                                    <button onClick={() => updateCount(count + 10)} className="bg-white/10 hover:bg-yellow-400 hover:text-stone-900 p-4 rounded-2xl font-black text-xl transition-all active:scale-90">+10</button>
                                </div>
                                <div className="space-y-2">
                                    <button onClick={() => updateCount(count - 1)} className="w-full bg-black/20 p-2 rounded-xl text-xs font-bold text-white/40 hover:text-white">-1 Correction</button>
                                    <button onClick={() => confirm('Reset Counter?') && updateCount(0)} className="w-full bg-red-900/30 p-2 rounded-xl text-xs font-bold text-red-400 hover:bg-red-600 hover:text-white transition-colors">RESET ALL</button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Launchpad Overlay */}
                    {!isStarted && (
                        <div className="fixed inset-0 z-[200] bg-stone-950 flex items-center justify-center text-center">
                            <div className="p-16 glass-panel border-4 border-yellow-400/50 rounded-[4rem] max-w-xl mx-4">
                                <div className="mb-8 flex justify-center">
                                    <div className="w-24 h-24 bg-yellow-400 rounded-3xl flex items-center justify-center font-black text-stone-950 text-6xl shadow-[0_0_50px_rgba(250,204,21,0.3)] animate-bounce">A</div>
                                </div>
                                <h1 className="text-5xl font-black text-white mb-4 tracking-tighter italic">AFRICA TRACKER</h1>
                                <p className="text-stone-400 font-bold mb-12 tracking-[0.2em] text-sm uppercase">High-Fidelity Broadcast Engine v2.5</p>
                                <button 
                                    onClick={() => { 
                                        audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
                                        setIsStarted(true); 
                                    }} 
                                    className="group relative bg-yellow-400 text-stone-950 font-black py-6 px-16 rounded-full text-2xl hover:bg-white transition-all hover:scale-105 active:scale-95 shadow-[0_20px_50px_rgba(250,204,21,0.2)]"
                                >
                                    START LIVE FEED
                                    <div className="absolute -inset-1 bg-yellow-400 rounded-full blur opacity-30 group-hover:opacity-60 transition-opacity"></div>
                                </button>
                                <div className="mt-8 text-white/20 font-mono text-[10px] tracking-widest uppercase italic">Optimized for Church Broadcast Displays</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
